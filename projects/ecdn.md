#### 1.项目介绍

CDN运维管理平台，提供带宽监控、数据汇聚分析、机房/服务器/业务管理等核心功能，管理5w+在线服务器、每月流量数据亿级。

主要负责监控看板相关部分，这部分包括目录节点、图形信息、利用率小助手、流量实时汇聚和一些流量导出功能。

#### 2.需求开发

1. 带宽管理系统性能优化---性能提升
    * 增加HTTP层缓存，接口响应时间降低到100ms以内:
        * 一般来说对目录的每个节点点击加载时间在2s左右，其中包含接口返回时间1s和前端渲染1s，对于后端带宽管理系统，增加一个中间件根据请求的方法、地址、参数共同组成一个key，然后把响应结果作为value存入Redis中，如果新的请求key在Redis中已经存在就直接从Redis获取结果返回，降低了资源消耗，提高数据库稳定性。
        * 新增自定义Header标识是否需要走缓存策略，响应如果命中缓存也带上Header标识。
        * 避免对Redis造成负担，限制缓存数量，服务启动定时任务清理超过最大数量的缓存对象。
        * 首屏缓存自动加载，每个五分钟任务模拟访问看板的节点，用户访问时命中缓存的概率大大提高。
    * 接口报文压缩，降低高并发场景下公网出口带宽消耗和Redis内存占用。

2. 微服务拆分和热数据治理---稳定性治理
    * 平台要对服务器进行流量探活，原有逻辑对于探活信息存储在MySQL的服务器元数据表中，每个五分钟进行大量服务器字段的刷新，对表和数据库造成较大压力容易造成服务单点故障，把服务器探活信息迁移到单独的表，并且增加服务缓存增量写表。
    * 原有服务属于大单体，几十万行代码，某个功能出现问题会导致整个服务不可用，梳理API接口和代码调用关系，逐步拆分成单独的服务，提高各模块稳定性。

3. 三线机房运营商流量拆分需求---业务价值
    * 三线三IP模式，每台服务器有三块独立的网卡分别接入对应运营商，有三个公网IP进出流量。
    * 对于目录、图形列表、图形流量查询、流量实时汇聚都做对应适配，满足业务需求。
    * 流量拆分后对于网络流量可以进行精细化管理，解决资源浪费和体验不均等问题，提高业务运维的工作效率。

#### 问题处理

1. 图形查询部分(随机1/3)展示为空，根据后端接口返回发现部分图形数据结构返回空，本地连接数据库调试发现在进行数据库查询时，会有概率返回err或nil，但是这部分的数据没有问题，再次请求可能会正常返回，结合数据库实例数量判断是云山数据库的问题，阿里云结论为ClickHouse的一个节点OOM为内核问题，业务无关。

2. 数据表写入数据失败，经过排查自增主键为INT类型，自增机制无法生成超过类型最大值的主键值导致写入失败，整改主键类型为BIGINT。